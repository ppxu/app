KISSY.add("gallery/kscroll/1.1/index",function(b,g){alert(1);var c=g.all,i=function(j){return j<0?-j:j},d=function(j){return isNaN(parseInt(j))?0:parseInt(j)},f='<div class="{prefix}scrollbar"><div class="{prefix}track" ><div class="{prefix}drag" ><div class="{prefix}dragtop"></div><div class="{prefix}dragbottom"></div><div class="{prefix}dragcenter"></div></div></div></div>',e='<div class="{prefix}arrow{type}"><a href="javascript:void(\'scroll {type}\')" >scroll {type}</a></div>';function h(j){return j.charAt(0).toUpperCase()+j.substring(1)}function a(j,l){var k=this;a.superclass.constructor.call(k,l);k._init(j)}a.ATTRS={prefix:{value:"ks-"},duration:{value:0.1},easing:{value:"easeNone"},container:{},body:{},track:{},drag:{},arrowUp:{},allowArrow:{value:true},arrowDown:{},step:{},scrollBar:{}};b.extend(a,b.Base,{_init:function(j){var k=this,l="."+k.get("prefix");j=k._wrap(c(j));k.set("container",j);k.set("body",j.one(l+"body"));k.set("track",j.one(l+"track"));k.set("drag",this.get("track").one(l+"drag"));if(k.get("allowArrow")){k.set("arrowUp",j.one(l+"arrowup"));k.arrowUpHeight=k.get("arrowUp").outerHeight();k.set("arrowDown",j.one(l+"arrowdown"));k.arrowDownHeight=k.get("arrowDown").outerHeight()}else{k.arrowUpHeight=k.arrowDownHeight=0}k._bindEvt();k._setSize()},destroy:function(){var m=this,l=m.get("container"),k=m.get("track"),n=m.get("arrowUp"),j=m.get("arrowDown"),o=l.children().item(0);if(n){n.remove()}if(j){j.remove()}o.insertBefore(l);l.remove();o.css(m.__backup);o.removeClass(m.get("prefix")+"body")},_wrap:function(j){var k=this,n=k.get("prefix"),m=c("<div></div>");if(b.UA.ie==6){j.css({overflow:"auto"})}m.insertAfter(j).append(j);m.addClass(n+"container").css({position:"relative",overflow:"hidden",width:j.outerWidth(),height:j.outerHeight()});m.append(b.substitute(f,{prefix:n}));var o=m.one("."+n+"scrollbar");k.set("scrollBar",o);if(k.get("allowArrow")){o.append(b.substitute(e,{type:"up",prefix:n}));o.append(b.substitute(e,{type:"down",prefix:n}))}var l=j[0].style;k.__backup={position:l.position,top:l.top,left:l.left,width:l.width,height:l.height,overflow:l.overflow};j.css({position:"absolute",top:0,left:0,width:"100%",height:"auto",overflow:"visible"}).addClass(n+"body");return m},_bindArrow:function(l){var j=this,k=h(l),o=0,r=null,m=j.get("prefix"),q=j.get("arrow"+k),p=function(){o+=1;var u=j.get("step");var s=l=="up"?u:-u,n=300-o*25;j.scrollByDistance(s);if(n<=30){n=30}r=setTimeout(function(){p()},n)};q.on("click",function(){var n=j.get("step");j.scrollByDistance(l=="up"?n:-n)}).on("mousedown",function(){q.addClass(m+"arrow"+l+"-active");p()}).on("mouseup",function(){q.removeClass(m+"arrow"+l+"-active");o=0;clearTimeout(r)}).on("mouseleave",function(){q.removeClass(m+"arrow"+l+"-active");o=0;q.removeClass(m+"arrow"+l+"-hover");clearTimeout(r)}).on("mouseover",function(){q.addClass(m+"arrow"+l+"-hover")})},_bindDrag:function(){var q=c(document),k=this,l,o=k.get("prefix"),p=0,m=k.get("drag"),j=k.get("track"),n=function(v){var s=j.outerHeight(),w=m.outerHeight(),u=s-w,r=p+(v.pageY-l);if(r<0){r=0}if(r>u){r=u}m.css("top",r);k.scrollByPercent(r/u,1)};m.on("mouseenter",function(r){m.addClass(o+"drag-hover")}).on("mouseleave",function(r){m.removeClass(o+"drag-hover")}).on("click",function(r){r.stopPropagation()}).on("mousedown",function(r){m.addClass(o+"drag-active");p=parseInt(m.css("top"))||0;l=r.pageY;q.on("mousemove",n).on("mouseup",function(){m.removeClass(o+"drag-active");q.detach("mousemove",n);q.detach("mouseup",arguments.callee);l=0})})},_bindHotkey:function(){var l=this,j=l.get("body"),k=l.get("container"),m=function(o){var n=d(j.css("top"));if(o>0&&n>=0){return false}if(o<0&&n+j.outerHeight()<=k.outerHeight()){return false}return true};k.css("outline","none").attr("tabindex",b.guid()).on("keydown",function(p){var n=p.keyCode,o=l.get("step");if(~"INPUT,TEXTAREA".indexOf(p.target.nodeName.toUpperCase())){return}if(!~"38,39,36,40,37,35".indexOf(n)){return}var q=~"38,39,36".indexOf(n)?o:-o;if(m(q)){p.halt()}switch(n){case 38:case 39:l.scrollByDistance(o);break;case 40:case 37:l.scrollByDistance(-o);break;case 36:l.scrollByPercent(0);break;case 35:l.scrollByPercent(1);break}})},_bindTrack:function(){var k=this,l=k.get("prefix");var j=k.get("track");j.unselectable().on("click",function(m){k.scrollByPercent((m.pageY-j.offset().top)/(j.outerHeight()))}).on("mousedown",function(m){m.preventDefault()}).on("mouseenter",function(){j.addClass(l+"track-hover")}).on("mouseleave",function(m){j.removeClass(l+"track-hover")})},_bindBodyDrag:function(){var k=this,n=c(document),j=k.get("body"),l=0,m=function(o){if(l>o.pageY){k.scrollByDistance(5)}else{k.scrollByDistance(-5)}};j.on("mousedown",function(o){l=o.pageY;n.on("mousemove",m).on("mouseup",function(){n.detach("mousemove",m);n.detach("mouseup",arguments.callee);l=0})})},_bindContainer:function(){var l=this,j=l.get("body"),k=l.get("container"),m=function(o){var n=d(j.css("top"));if(o>0&&n>=0){return false}if(o<0&&n+j.outerHeight()<=k.outerHeight()){return false}return true};l.get("container").on("mousewheel",function(o){if(m(o.deltaY)){o.halt()}var n=l.get("step");l.scrollByDistance(o.deltaY>0?n:-n)})},_bindEvt:function(){var j=this;j._bindContainer();if(j.get("allowArrow")){j._bindArrow("up");j._bindArrow("down")}j._bindTrack();j._bindDrag();if(j.get("hotkey")===true){j._bindHotkey()}if(j.get("bodydrag")){j._bindBodyDrag()}},resize:function(j,l){var k=this;k.get("container").css({width:j,height:l});k._setSize()},_setSize:function(){var r=this,n=r.get("body").outerHeight(),p,j=r.get("container").innerHeight(),k=r.get("arrowUp"),m=r.get("arrowDown"),l=r.get("track"),o=r.get("drag"),q=r.arrowUpHeight+r.arrowDownHeight;if(n<=j||j<q){r.get("body").css({top:0});r.get("scrollBar").hide();return}else{r.get("scrollBar").show()}p=(j-q)*j/n;if(p<20){p=20}if(!r.get("step")){r.set("step",Math.max(p/6,10))}l.css({height:j-q,top:r.arrowUpHeight});o.css({height:p})},_scrollBodyToPosition:function(k){var m=this,l=m.get("container"),j=m.get("body"),n=j.outerHeight()-l.innerHeight();if(n<0){return}if(k>0){k=0}if(i(k)>n){k=-n}j.css("top",k)},scrollByDistance:function(m,l){var k=this,j=parseInt(k.get("body").css("top"))+m;k._scrollBodyToPosition(j);if(!l){k._updateBar()}},scrollByPercent:function(l,k){var j=this;l=parseFloat(l,10);if(isNaN(l)||l>1||l<0){return}var m=(j.get("body").outerHeight()-j.get("container").innerHeight())*(-l);j._scrollBodyToPosition(m);if(!k){j._updateBar()}},scrollToElement:function(l){l=c(l);if(!l.length){return}var k=this,j=l.offset().top-k.get("body").offset().top;k._scrollBodyToPosition(-j);k._updateBar()},_updateBar:function(){var l=this,m=l.get("drag"),o=l.get("track").innerHeight()-m.outerHeight(),j=l.get("body"),k=l.get("container"),n=i(parseInt(j.css("top")))/(j.outerHeight()-k.innerHeight());m.css("top",n*o)}});return a},{requires:["node"]});
